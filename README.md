# replease-scripts

リリース作業を楽にするスクリプト群です。

## できること

- 任意のモジュールのpom.xmlのバージョンアップ
- 任意のモジュールのリリース資材をローカルGitリポジトリで固める
- masterブランチからタグを切ってプッシュする

## 思想

- `origin`リポジトリ内のいくつかのブランチに直接バージョンインクリメントの修正をコミットする。
- リリース資材は`mvn clean package`で`target`ディレクトリに出力される。
- 最終的に`master`ブランチに最新のソースコードが格納される。(タグがmasterブランチから切られる。)

## 使用準備

```sh
grep -rn 'TODO' *
```

で出てきた箇所を適切な値にしてください。

## 使い方

### バージョンインクリメント

```sh
cd ./subscripts/versionup
sh ./versionup.sh ${MODULE} ${VERSION}
```

- 設定されたブランチから必要に応じてチェックアウト/マージを行います。
- Vimを起動してバージョンインクリメントさせてくれます。
- また、`origin`に向けてプッシュもしてくれます。

### 資材固め

```sh
sh ./assemble-all-materials.sh ${VERSION} ${PROFILE}
```

- 設定されたブランチからチェックアウトしてきた資材を固めてくれます。
- 固められた資材を自動で該当バージョンのディレクトリにコピーしてくれます。

### 対応モジュールを増やしたい！

`./subscripts/common/`に行を追加してください。

ただしシェルの仕様上、 **変数名にアンダースコアは使えない** ので
アンダースコア(`_`)はハイフン(`-`)に置き換えて記入してください。

その後、次項以降の必要な設定を書き換えてください。

### バージョンインクリメントのブランチ設定を変えたい！

`./subscripts/versionup/branch.conf`を修正してください。
対応する変数名を追加してあげれば読み込んでくれます。

### 資材固めのブランチ設定を変えたい！

`./subscripts/assemble/branch.conf`を修正してください。

### 資材固めの時実行するコマンドが変わった！

基本`mvn clean package`で資材ができるようにpom.xmlを修正することをお奨めします...。
どうしてもいう場合は、`./subscripts/assemble/assemble.sh`内のMavenコマンドを修正してください。
現在ここはデータの外部化ができていないので決め打ちになっています。
